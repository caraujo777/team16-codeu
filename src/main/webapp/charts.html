<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {packages: ['corechart']});
        google.charts.setOnLoadCallback(
          function() {
            fetchMessageData();
          }
        );

        function drawChart(in_data) {
           
          var chart = new google.visualization.ScatterChart(document.getElementById('new-chart'));
          var chart_options = {
            title: "Message Volume History",
            legend: 'none',
            hAxis: {title: 'Date'},
            vAxis: {title: 'Message Count'},
            width: 900,
            height: 500
          };

          chart.draw(in_data, chart_options);
      }

      function fetchMessageData() {
          fetch("/messagechart")
           .then((response) => {
              return response.json();
           })
           .then((msgJson) => {
             var msgData = new google.visualization.DataTable();
             msgData.addColumn('date', 'Date');
             msgData.addColumn('number', 'Message Count');
             var totalMessages = 0;
             for (i = msgJson.length-1; i >= 0; i--) {
              msgRow = [];
              var timestampAsDate = new Date(msgJson[i].timestamp);
              timestampAsDate.setSeconds(0,0);
              var totalMessages = totalMessages + 1;
              msgRow.push(timestampAsDate);
              msgRow.push(totalMessages);
              msgData.addRow(msgRow);
             }
             
             drawChart(msgData);
           });
      }
    </script>
    <title>Charts</title>
  </head>
  <body>
    <h1>Message Count</h1>
    <div id="new-chart"></div>
  </body>
</html> 
